---
import '../styles/global.css';

interface Props {
  title: string;
}

const { title } = Astro.props;
const year = new Date().getFullYear();
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      // Prevent FOUC / flash of wrong theme by applying stored or system theme
      (function () {
        try {
          var storageKey = 'theme';
          var cls = 'dark';
          var stored = localStorage.getItem(storageKey);
          if (stored === 'dark') document.documentElement.classList.add(cls);
          else if (stored === 'light') document.documentElement.classList.remove(cls);
          else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add(cls);
        } catch (e) {
          /* ignore */
        }
      })();
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
  </head>
  <body class="min-h-screen flex flex-col">
    <!-- Site header (logo left, theme toggle right) -->
    <header class="site-header bg-purple-700 dark:bg-purple-900 py-3">
      <div class="container mx-auto px-4 flex items-center justify-between">
        <a href="/" class="text-xl font-bold text-white">AVMS</a>

        <div>
          <button id="theme-toggle" aria-label="Toggle theme" class="inline-flex items-center gap-2 px-3 py-1 rounded-md bg-white/10 text-white hover:bg-white/20 dark:bg-black/20 dark:hover:bg-black/30 transition-colors" aria-pressed="false">
            <!-- Moon icon (show when light theme) -->
            <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path d="M17.293 13.293A8 8 0 116.707 2.707a7 7 0 0010.586 10.586z" />
            </svg>
            <!-- Sun icon (show when dark theme). Simplified so it scales correctly. -->
            <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 hidden" viewBox="0 0 24 24" aria-hidden="true">
              <g fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="4" fill="currentColor" />
                <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" />
              </g>
            </svg>
            <span class="sr-only">Toggle theme</span>
          </button>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="site-footer bg-gray-900 dark:bg-gray-800 text-gray-300 mt-auto">
      <div class="container mx-auto px-4 py-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="text-sm">Â© {year} AVMS. All rights reserved.</div>

        <div class="flex items-center space-x-4">
          <a href="https://vimeo.com/hwsavms" target="_blank" rel="noopener noreferrer" aria-label="Vimeo" title="Vimeo" class="hover:text-white">
            <!-- Official-style Vimeo mark (simplified) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
              <path fill="currentColor" d="M21.9 7.3c-.1 2.1-1.6 5.2-4.3 9.1-2.8 4.1-5.1 6-7.1 6-1.2 0-2.2-1.1-3.1-3.1-.7-1.6-1.4-3.1-2.1-4.7-1.3-3-2.7-4.5-4.3-4.5-.3 0-1.5.6-3.5 1.8L0 9.8C3 6.9 5.6 5.1 7.8 5.1c2.9 0 4.8 1.9 5.6 5.6.6 3 1.1 4.6 1.4 4.9.8.8 1.8 1.3 2.8 1.3 1.6 0 3.2-1.6 4.8-4.8 1.4-2.6 2.1-4.2 2-4.8-.1-.2-.4-.3-1-.3-.9 0-1.6.4-1.9 1.1z" />
            </svg>
          </a>

          <a href="https://www.youtube.com/@HWSiTV" target="_blank" rel="noopener noreferrer" aria-label="YouTube" title="YouTube" class="hover:text-white">
            <!-- Official-style YouTube play button -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
              <path fill="currentColor" d="M23.5 6.2a3 3 0 00-2.1-2.1C19.4 3.5 12 3.5 12 3.5s-7.4 0-9.4.6A3 3 0 00.5 6.2C0 8.6 0 12 0 12s0 3.4.5 5.8a3 3 0 002.1 2.1c2 0.6 9.4.6 9.4.6s7.4 0 9.4-.6a3 3 0 002.1-2.1C24 15.4 24 12 24 12s0-3.4-.5-5.8zM9.8 15.5V8.5l6.6 3.5-6.6 3.5z" />
            </svg>
          </a>

          <a href="https://hws.teamdynamix.com/TDClient/1889/Portal/Requests/ServiceDet?ID=31662" aria-label="Website" title="Website" class="hover:text-white">
            <!-- Globe / website icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" fill="currentColor" aria-hidden="true">
              <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm6 10a8.1 8.1 0 01-.4 2.4H8.4A8.1 8.1 0 018 12c0-.8.1-1.6.4-2.4h9.2c.2.8.4 1.6.4 2.4zM12 4c1.7 0 3.3.6 4.6 1.6-.7 1.1-1.6 2.6-2.3 4-.7 1.4-1.3 2.8-1.9 4.1-1.8-3.3-2.9-6.1-3.3-7.2C9.4 5 10.6 4 12 4z" />
            </svg>
          </a>
        </div>
      </div>
    </footer>

    <script>
      // Theme toggle script: persist in localStorage and toggle the `dark` class on <html>
      (function () {
        const storageKey = 'theme';
        const className = 'dark';
        const btn = document.getElementById('theme-toggle');
        const iconSun = document.getElementById('icon-sun');
        const iconMoon = document.getElementById('icon-moon');

        if (!btn) return;

        function applyTheme(theme: 'dark' | 'light') {
          if (theme === 'dark') {
            document.documentElement.classList.add(className);
            iconSun?.classList.remove('hidden');
            iconMoon?.classList.add('hidden');
            btn?.setAttribute('aria-pressed', 'true');
          } else {
            document.documentElement.classList.remove(className);
            iconSun?.classList.add('hidden');
            iconMoon?.classList.remove('hidden');
            btn?.setAttribute('aria-pressed', 'false');
          }
        }

        // Initialize from localStorage, else from system preference
        const stored = localStorage.getItem(storageKey);
        if (stored === 'dark' || stored === 'light') {
          applyTheme(stored);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          applyTheme('dark');
        } else {
          applyTheme('light');
        }

        btn.addEventListener('click', () => {
          const isDark = document.documentElement.classList.contains(className);
          const next = isDark ? 'light' : 'dark';
          localStorage.setItem(storageKey, next);
          applyTheme(next);
        });
      })();
    </script>
  </body>
</html>